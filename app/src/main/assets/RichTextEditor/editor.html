<!DOCTYPE html>
<html lang=zh>
	<head>
		<meta charset=utf-8>
		<meta http-equiv=X-UA-Compatible content="IE=edge">
		<meta name=viewport content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<title>Markdown Editor</title>
	</head>
	<body>
		<div id="editor"></div>
	</body>
	<script src="quill.js" type="text/javascript"></script>
	<!-- Initialize Quill editor -->
	<script>
		var nativeCallbackHandler;
		var options = {
		};
		var quill = new Quill('#editor', options);
		quill.on('text-change', function(delta, oldDelta, source) {
			for (var i = 0; i < delta.ops.length; i++) {
				var operation  = delta.ops[i];
				if (operation.hasOwnProperty('attributes')) {
						nativeCallbackHandler.onFormatChanged(JSON.stringify(operation['attributes']));
				}
			}
		});

		function toggleBold() {
			var currentFormat = quill.getFormat();
			if (currentFormat.hasOwnProperty('bold') && currentFormat['bold']	== true) {
				quill.format('bold', false);
			} else {
				quill.format('bold', true);
			}
		}

		function toggleQuote() {
			var currentFormat = quill.getFormat();
			if (currentFormat.hasOwnProperty('blockquote') && currentFormat['blockquote']	== true) {
				quill.format('blockquote', false);
			} else {
				quill.format('blockquote', true);
			}
		}

		function toggleHeader() {
			var currentFormat = quill.getFormat();
			var currentHeadingLevel = currentFormat.hasOwnProperty('header') ? currentFormat['header'] : 1;
			var settingValue = currentHeadingLevel + 1;
			quill.format('header', settingValue);
		}

		function toggleItalic() {
			var currentFormat = quill.getFormat();
			if (currentFormat.hasOwnProperty('italic') && currentFormat['italic']	== true) {
				quill.format('italic', false);
			} else {
				quill.format('italic', true);
			}
		}

		function toggleBulletList() {
			var currentFormat = quill.getFormat();
			if (currentFormat.hasOwnProperty('list') && currentFormat['list']	== 'bullet') {
				quill.format('list', null);
			} else {
				quill.format('list', 'bullet');
			}
		}

		function toggleOrderedList() {
			var currentFormat = quill.getFormat();
			if (currentFormat.hasOwnProperty('list') && currentFormat['list']	== 'ordered') {
				quill.format('list', null);
			} else {
				quill.format('list', 'ordered');
			}
		}

        function selectionChangeHandler() {
            var range = quill.getSelection();
            if (range) {
                if (range.length == 0) {
                    var formats = quill.getFormat();
                    nativeCallbackHandler.onCusorChanged(range.index, JSON.stringify(formats))
                } else {
                    var text = quill.getText(range.index, range.length);
                    nativeCallbackHandler.onHighlighted(range.index, range.length, JSON.stringify(quill.getFormat(range.index, range.length)))
                }
            }
        }

        function enable() {
            document.addEventListener("selectionchange", selectionChangeHandler, false);
            quill.enable();
        }

        function disable() {
            document.removeEventListener("selectionchange", selectionChangeHandler, false);
            quill.disable();
        }
	</script>
</html>
